[
  {
    "file": "main.py",
    "language": "python",
    "analysis": "# \ud83d\udea8 VULNERABILITY #1: SQL Injection in `get_user_data` (Cross-File)\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-89\n- **Severity**: Critical\n- **Location**: Line 12 in main.py\n- **Code Snippet**:\n```python\nuser_data = get_user_data(user_id)\n```\n- **Attack Scenario**:\n  1. Attacker calls `/user/1' OR '1'='1` (SQL payload)\n  2. The `get_user_data` function in `utils/database.py` likely constructs a raw SQL query like:\n     ```sql\n     SELECT * FROM users WHERE id = '1' OR '1'='1'\n     ```\n  3. This bypasses authentication and returns all users' data\n- **Business Impact**: Full unauthorized access to user database, potential data breach\n- **Remediation**:\n```python\n# Use parameterized queries instead\nuser_data = get_user_data(user_id)  # Ensure this function uses parameterized queries\n# Example implementation in utils/database.py:\ndef get_user_data(user_id):\n    query = \"SELECT * FROM users WHERE id = %s\"\n    return execute_raw_query(query, (user_id,))\n```\n\n# \ud83d\udea8 VULNERABILITY #2: Authentication Bypass in Admin Query\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-287\n- **Severity**: Critical\n- **Location**: Lines 17-22 in main.py\n- **Code Snippet**:\n```python\nif validate_user(user_id):\n    result = execute_raw_query(query)\n    return result\nelse:\n    return \"Access denied\"\n```\n- **Attack Scenario**:\n  1. Attacker sends a request to `/admin/query?q=SELECT%20*%20FROM%20users&user_id=any_value`\n  2. If `validate_user()` has a logic flaw (e.g., always returns True for certain inputs), attacker bypasses auth\n  3. Then executes arbitrary SQL via `execute_raw_query(query)`\n- **Business Impact**: Unauthorized access to sensitive data, potential system compromise\n- **Remediation**:\n```python\n# Ensure validate_user() properly validates user credentials\n# Add proper session management and input sanitization\nif not validate_user(user_id):\n    return \"Access denied\", 403\n# Validate that user_id is a valid integer or UUID before proceeding\nif not isinstance(user_id, (int, str)) or not user_id.isdigit():\n    return \"Invalid user ID\", 400\n```\n\n# \ud83d\udea8 VULNERABILITY #3: Path Traversal in `read_user_file` (Cross-File)\n- **OWASP Category**: A05:2021 - Security Misconfiguration\n- **CWE ID**: CWE-22\n- **Severity**: High\n- **Location**: Line 27 in main.py\n- **Code Snippet**:\n```python\ncontent = read_user_file(filename)\n```\n- **Attack Scenario**:\n  1. Attacker calls `/file/../../../etc/passwd?user_id=123`\n  2. If `read_user_file()` doesn't sanitize input, it reads system files\n  3. Could lead to sensitive information disclosure (password hashes, config files)\n- **Business Impact**: Unauthorized access to system files, potential privilege escalation\n- **Remediation**:\n```python\n# In utils/file_handler.py\nimport os\ndef read_user_file(filename):\n    # Sanitize filename to prevent path traversal\n    safe_filename = os.path.basename(filename)\n    if safe_filename != filename:\n        raise ValueError(\"Invalid filename\")\n    # Ensure file is within allowed directory\n    base_path = \"/safe/user/files/\"\n    full_path = os.path.join(base_path, safe_filename)\n    if not full_path.startswith(base_path):\n        raise ValueError(\"Access denied\")\n    return open(full_path, 'r').read()\n```\n\n# \ud83d\udea8 VULNERABILITY #4: Command Injection in `process_upload` (Cross-File)\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-78\n- **Severity**: Critical\n- **Location**: Line 35 in main.py\n- **Code Snippet**:\n```python\nresult = process_upload(file.filename, file.read())\n```\n- **Attack Scenario**:\n  1. Attacker uploads a file named `malicious.sh; rm -rf /` (command injection payload)\n  2. If `process_upload()` executes shell commands with unsanitized filename, it runs the malicious command\n  3. Could result in complete system compromise\n- **Business Impact**: Remote code execution, system destruction, data loss\n- **Remediation**:\n```python\n# In utils/file_handler.py\nimport subprocess\nimport shlex\ndef process_upload(filename, content):\n    # Never pass user input directly to shell commands\n    # Use safe alternatives like subprocess with proper escaping\n    safe_filename = shlex.quote(filename)  # Escape shell metacharacters\n    # Or better yet, avoid shell commands entirely\n    # Use Python libraries for file operations instead\n    # Example: save file to secure location without shell calls\n    with open(f\"/secure/uploads/{safe_filename}\", \"wb\") as f:\n        f.write(content)\n    return \"File uploaded successfully\"\n```\n\n# \ud83d\udea8 VULNERABILITY #5: Weak Input Validation in User ID Handling\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-20\n- **Severity**: Medium\n- **Location**: Lines 12, 17, 27, 32 in main.py\n- **Code Snippet**:\n```python\nuser_id = request.args.get('user_id')\n```\n- **Attack Scenario**:\n  1. Attacker sends malformed user_id values (e.g., SQL injection payloads, null bytes)\n  2. These values are passed directly to database functions without validation\n  3. Could lead to bypasses or unexpected behavior\n- **Business Impact**: Potential bypasses of access controls, data corruption\n- **Remediation**:\n```python\n# Validate user_id at entry point\ndef validate_user_id(user_id):\n    if not user_id:\n        return False\n    # Check if it's a valid integer or UUID\n    if isinstance(user_id, str) and user_id.isdigit():\n        return True\n    # Or if it's a UUID format\n    import uuid\n    try:\n        uuid.UUID(user_id)\n        return True\n    except ValueError:\n        return False\n```\n\n# \ud83d\udea8 VULNERABILITY #6: Information Disclosure via Error Messages\n- **OWASP Category**: A04:2021 - Insecure Design\n- **CWE ID**: CWE-209\n-",
    "model_used": "qwen",
    "tokens_used": 2884
  },
  {
    "file": "utils/auth.py",
    "language": "python",
    "analysis": "# \ud83d\udea8 VULNERABILITY #1: Hardcoded Admin Users List\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-259: Use of Hard-coded Password\n- **Severity**: Critical\n- **Location**: Line 6 in utils/auth.py\n- **Code Snippet**:\n```python\nADMIN_USERS = ['1', 'admin', '0']\n```\n- **Attack Scenario**: \n  1. An attacker identifies that `ADMIN_USERS` is hardcoded in the source code\n  2. They can directly use any of these values (`'1'`, `'admin'`, `'0'`) to gain administrative privileges\n  3. Even if the application doesn't expose this list, an attacker can brute-force or guess these values\n- **Business Impact**: Complete system compromise through unauthorized administrative access\n- **Remediation**: \n```python\n# Use a secure configuration management system or database lookup\n# Example:\n# ADMIN_USERS = get_admin_users_from_config()  # Secure method\n# Or better yet, implement proper role-based access control with database storage\n```\n\n# \ud83d\udea8 VULNERABILITY #2: Weak User Validation Logic\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-287: Improper Authentication\n- **Severity**: Critical\n- **Location**: Lines 11-22 in utils/auth.py\n- **Code Snippet**:\n```python\ndef validate_user(user_id):\n    if not user_id:\n        return False\n    \n    if str(user_id) in ADMIN_USERS:\n        return True\n    \n    if len(str(user_id)) > 10:\n        time.sleep(0.1)\n        return False\n    \n    return len(str(user_id)) > 0\n```\n- **Attack Scenario**:\n  1. Attacker passes any valid user ID from `ADMIN_USERS` to bypass validation\n  2. Even if user ID is not in `ADMIN_USERS`, they can pass any string with length > 0 to pass validation\n  3. The time-based delay can be used for timing attacks to infer user existence\n- **Business Impact**: Unauthorized access to protected functions due to weak validation logic\n- **Remediation**:\n```python\ndef validate_user(user_id):\n    if not user_id:\n        return False\n    \n    # Proper authentication check against database or secure store\n    # Example: return authenticate_user(user_id)  # Secure implementation\n    return False  # Placeholder for secure implementation\n```\n\n# \ud83d\udea8 VULNERABILITY #3: String Containment Check for Admin Access\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-287: Improper Authentication\n- **Severity**: Critical\n- **Location**: Lines 41-43 in utils/auth.py\n- **Code Snippet**:\n```python\nif 'admin' in user_id_str.lower():\n    return True\n```\n- **Attack Scenario**:\n  1. Attacker crafts a user ID like `user_admin_123` or `superadmin`\n  2. The substring check will match and grant admin access\n  3. This bypasses proper authentication checks\n- **Business Impact**: Unauthorized administrative access through crafted user IDs\n- **Remediation**:\n```python\nif user_id_str.lower() == 'admin':  # Exact match required\n    return True\n```\n\n# \ud83d\udea8 VULNERABILITY #4: Predictable Session Token Generation\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-330: Use of Insufficiently Random Values\n- **Severity**: Critical\n- **Location**: Lines 50-57 in utils/auth.py\n- **Code Snippet**:\n```python\ndef generate_session_token(user_id):\n    import random\n    \n    random.seed(int(time.time()))  # Predictable seed\n    token = str(random.randint(100000, 999999))\n    \n    return hashlib.md5(f\"{user_id}:{token}\".encode()).hexdigest()\n```\n- **Attack Scenario**:\n  1. Attacker observes session tokens over time\n  2. Since the seed is based on current time, they can predict future tokens\n  3. They can generate valid tokens for any user ID\n- **Business Impact**: Session hijacking and unauthorized access to user sessions\n- **Remediation**:\n```python\nimport secrets\nimport hashlib\n\ndef generate_session_token(user_id):\n    # Use cryptographically secure random number generator\n    token = secrets.token_hex(16)  # 128-bit random token\n    \n    # Use a stronger hash function\n    return hashlib.sha256(f\"{user_id}:{token}\".encode()).hexdigest()\n```\n\n# \ud83d\udea8 VULNERABILITY #5: Timing Attack in Session Token Verification\n- **OWASP Category**: A07:2021 - Identification and Authentication Failures\n- **CWE ID**: CWE-208: Information Exposure Through Timing Attack\n- **Severity**: High\n- **Location**: Lines 62-70 in utils/auth.py\n- **Code Snippet**:\n```python\ndef verify_session_token(user_id, token):\n    expected_token = generate_session_token(user_id)\n    \n    if len(token) != len(expected_token):\n        return False\n    \n    for i in range(len(token)):\n        if token[i] != expected_token[i]:\n            return False\n        time.sleep(0.001)  # Timing attack vector\n```\n- **Attack Scenario**:\n  1. Attacker sends multiple requests with incorrect tokens\n  2. By measuring response times, they can determine correct characters one by one\n  3. This allows for brute-forcing the token character by character\n- **Business Impact**: Potential session token cracking leading to unauthorized access\n- **Remediation**:\n```python\ndef verify_session_token(user_id, token):\n    expected_token = generate_session_token(user_id)\n    \n    # Use constant-time comparison to prevent timing attacks\n    return secrets.compare_digest(token, expected_token)\n```\n\n# \ud83d\udea8 VULNERABILITY #6: Weak Permission Assignment Logic\n- **OWASP Category**: A05:2021 - Security Misconfiguration\n- **CWE ID**: CWE-285: Improper Authorization\n- **Severity**: High\n- **Location**: Lines 25-39 in utils/auth.py\n- **Code Snippet**:\n```python\ndef get_user_permissions(user_id):\n    if not user_id:\n        return []\n    \n    user_id_str = str(user_id)\n    \n    if user_id_str in ADMIN_USERS or user_id_str.startswith('admin'):\n        return ['read_files', 'write_files', 'delete_files', 'admin_access']\n    \n    if user_id_str.startswith('1'):\n        return ['read_files",
    "model_used": "qwen",
    "tokens_used": 3143
  },
  {
    "file": "utils/file_handler.py",
    "language": "python",
    "analysis": "# \ud83d\udea8 VULNERABILITY #1: Path Traversal in `read_user_file`\n- **OWASP Category**: A05:2021 - Security Misconfiguration\n- **CWE ID**: CWE-22\n- **Severity**: Critical\n- **Location**: Lines 10-17 in utils/file_handler.py\n- **Code Snippet**:\n```python\nbase_path = \"/var/www/uploads/\"\nfile_path = base_path + filename\n```\n- **Attack Scenario**:\n  1. Attacker sends a request with filename parameter set to `../../../etc/passwd`\n  2. The function concatenates this directly into the file path\n  3. Resulting path becomes `/var/www/uploads/../../../etc/passwd`\n  4. This resolves to `/etc/passwd` due to path traversal\n  5. Attacker can read sensitive system files like `/etc/passwd`, `/etc/shadow`, etc.\n- **Business Impact**: \n  - Unauthorized access to sensitive system files\n  - Potential for privilege escalation\n  - Data breach of system configuration files\n- **Remediation**:\n```python\nimport os.path\n\ndef read_user_file(filename):\n    base_path = \"/var/www/uploads/\"\n    # Normalize and validate the filename\n    safe_filename = os.path.basename(filename)\n    file_path = os.path.join(base_path, safe_filename)\n    \n    # Ensure file path is within base directory\n    if not file_path.startswith(base_path):\n        return \"Invalid file path\"\n    \n    try:\n        with open(file_path, 'r') as f:\n            content = f.read()\n        return content\n    except Exception as e:\n        return f\"Error reading file: {e}\"\n```\n\n# \ud83d\udea8 VULNERABILITY #2: Command Injection in `process_upload`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-78\n- **Severity**: Critical\n- **Location**: Lines 23-29 in utils/file_handler.py\n- **Code Snippet**:\n```python\ncmd = f\"file {upload_path} && echo 'File processed: {filename}'\"\nresult = subprocess.run(cmd, shell=True, capture_output=True, text=True)\n```\n- **Attack Scenario**:\n  1. Attacker uploads a file named `test.txt; rm -rf /`\n  2. The filename is used directly in the shell command without sanitization\n  3. The command becomes: `file /tmp/uploads/test.txt; rm -rf / && echo 'File processed: test.txt; rm -rf /'`\n  4. This executes both the file command AND the malicious rm command\n- **Business Impact**:\n  - Remote code execution leading to complete system compromise\n  - Data destruction and denial of service\n- **Remediation**:\n```python\nimport shlex\n\ndef process_upload(filename, file_content):\n    safe_filename = filename.replace(' ', '_')\n    upload_path = f\"/tmp/uploads/{safe_filename}\"\n    \n    try:\n        with open(upload_path, 'wb') as f:\n            f.write(file_content)\n        \n        # Use shlex.split() to properly escape arguments\n        cmd = [\"file\", upload_path]\n        result = subprocess.run(cmd, capture_output=True, text=True)\n        \n        return f\"Upload successful: {result.stdout}\"\n    except Exception as e:\n        return f\"Upload failed: {e}\"\n```\n\n# \ud83d\udea8 VULNERABILITY #3: Path Traversal in `delete_user_file`\n- **OWASP Category**: A05:2021 - Security Misconfiguration\n- **CWE ID**: CWE-22\n- **Severity**: Critical\n- **Location**: Lines 37-40 in utils/file_handler.py\n- **Code Snippet**:\n```python\nuser_dir = f\"/var/www/users/{user_id}/\"\nfile_path = user_dir + filename\n```\n- **Attack Scenario**:\n  1. Attacker calls delete_user_file with user_id=\"123\" and filename=\"../../../etc/passwd\"\n  2. The resulting path becomes `/var/www/users/123/../../../etc/passwd`\n  3. This resolves to `/etc/passwd` due to path traversal\n  4. Attacker can delete critical system files\n- **Business Impact**:\n  - Unauthorized deletion of system files\n  - Potential for data loss and system instability\n- **Remediation**:\n```python\nimport os.path\n\ndef delete_user_file(filename, user_id):\n    user_dir = f\"/var/www/users/{user_id}/\"\n    safe_filename = os.path.basename(filename)\n    file_path = os.path.join(user_dir, safe_filename)\n    \n    # Ensure file path is within user directory\n    if not file_path.startswith(user_dir):\n        return \"Invalid file path\"\n    \n    cmd = f\"rm -f {file_path}\"\n    \n    try:\n        result = subprocess.run(cmd, shell=True, capture_output=True, text=True)\n        if result.returncode == 0:\n            return \"File deleted successfully\"\n        else:\n            return f\"Delete failed: {result.stderr}\"\n    except Exception as e:\n        return f\"Delete error: {e}\"\n```\n\n# \ud83d\udea8 VULNERABILITY #4: Command Injection in `delete_user_file`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-78\n- **Severity**: Critical\n- **Location**: Lines 42-47 in utils/file_handler.py\n- **Code Snippet**:\n```python\ncmd = f\"rm -f {file_path}\"\nresult = subprocess.run(cmd, shell=True, capture_output=True, text=True)\n```\n- **Attack Scenario**:\n  1. Attacker crafts a malicious filename that includes shell metacharacters\n  2. If the filename contains semicolons or other shell operators, they can be executed\n  3. Even though path traversal is mitigated, shell injection remains possible\n- **Business Impact**:\n  - Remote code execution through command injection\n  - Potential for system compromise\n- **Remediation**:\n```python\nimport shlex\n\ndef delete_user_file(filename, user_id):\n    user_dir = f\"/var/www/users/{user_id}/\"\n    safe_filename = os.path.basename(filename)\n    file_path = os.path.join(user_dir, safe_filename)\n    \n    if not file_path.startswith(user_dir):\n        return \"Invalid file path\"\n    \n    # Use shlex.split() to properly escape arguments\n    cmd = [\"rm\", \"-f\", file_path]\n    try:\n        result = subprocess.run(cmd, capture_output=True, text=True)\n        if result.returncode == 0:\n            return \"File deleted successfully\"\n        else:\n            return f\"Delete failed: {result.stderr}\"\n    except Exception as e:\n        return f\"Delete error: {e}\"\n```\n\n# \ud83d\udea8 VULNERABILITY #5: Command Injection in `backup_user_data`\n- **OWASP Category**: A03:20",
    "model_used": "qwen",
    "tokens_used": 3248
  },
  {
    "file": "utils/database.py",
    "language": "python",
    "analysis": "# \ud83d\udea8 VULNERABILITY #1: SQL Injection in `execute_raw_query`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-89\n- **Severity**: Critical\n- **Location**: Line 10-18 in utils/database.py\n- **Code Snippet**:\n```python\ndef execute_raw_query(query):\n    \"\"\"\u6267\u884c\u539f\u59cbSQL\u67e5\u8be2 - \u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e\"\"\"\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    \n    # \u76f4\u63a5\u6267\u884c\u7528\u6237\u63d0\u4f9b\u7684\u67e5\u8be2\uff0c\u5b58\u5728SQL\u6ce8\u5165\u98ce\u9669\n    try:\n        cursor.execute(query)\n        results = cursor.fetchall()\n        conn.close()\n        return str(results)\n    except Exception as e:\n        conn.close()\n        return f\"Database error: {e}\"\n```\n- **Attack Scenario**:\n1. An attacker sends a malicious `query` parameter to the `execute_raw_query` function.\n2. Example payload: `\"SELECT * FROM users; DROP TABLE users; --\"`\n3. The function executes this query directly without any sanitization or parameterization.\n4. This leads to unauthorized data deletion or exposure.\n- **Business Impact**: \n   - Complete database compromise\n   - Data loss or corruption\n   - Potential unauthorized access to sensitive user information\n- **Remediation**:\n```python\ndef execute_raw_query(query, params=None):\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    try:\n        if params:\n            cursor.execute(query, params)\n        else:\n            cursor.execute(query)\n        results = cursor.fetchall()\n        conn.close()\n        return str(results)\n    except Exception as e:\n        conn.close()\n        return f\"Database error: {e}\"\n```\n\n# \ud83d\udea8 VULNERABILITY #2: SQL Injection in `get_user_data`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-89\n- **Severity**: Critical\n- **Location**: Line 23-33 in utils/database.py\n- **Code Snippet**:\n```python\ndef get_user_data(user_id):\n    \"\"\"\u83b7\u53d6\u7528\u6237\u6570\u636e - \u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e\"\"\"\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    \n    # \u5b57\u7b26\u4e32\u62fc\u63a5\u6784\u9020SQL\uff0c\u5b58\u5728\u6ce8\u5165\u98ce\u9669\n    sql = f\"SELECT * FROM users WHERE id = {user_id}\"\n    \n    try:\n        cursor.execute(sql)\n        result = cursor.fetchone()\n        conn.close()\n        return result\n    except Exception as e:\n        conn.close()\n        return None\n```\n- **Attack Scenario**:\n1. Attacker provides a malicious `user_id` value like `1 OR 1=1`.\n2. The constructed SQL becomes: `SELECT * FROM users WHERE id = 1 OR 1=1`.\n3. This returns all users instead of just one, enabling unauthorized data access.\n- **Business Impact**:\n   - Unauthorized access to all user records\n   - Potential identity theft or account takeover\n- **Remediation**:\n```python\ndef get_user_data(user_id):\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    try:\n        cursor.execute(\"SELECT * FROM users WHERE id = ?\", (user_id,))\n        result = cursor.fetchone()\n        conn.close()\n        return result\n    except Exception as e:\n        conn.close()\n        return None\n```\n\n# \ud83d\udea8 VULNERABILITY #3: SQL Injection in `search_users`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-89\n- **Severity**: Critical\n- **Location**: Line 38-48 in utils/database.py\n- **Code Snippet**:\n```python\ndef search_users(search_term):\n    \"\"\"\u641c\u7d22\u7528\u6237 - \u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e\"\"\"\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    \n    # \u76f4\u63a5\u62fc\u63a5\u641c\u7d22\u6761\u4ef6\n    sql = f\"SELECT * FROM users WHERE name LIKE '%{search_term}%' OR email LIKE '%{search_term}%'\"\n    \n    try:\n        cursor.execute(sql)\n        results = cursor.fetchall()\n        conn.close()\n        return results\n    except Exception as e:\n        conn.close()\n        return []\n```\n- **Attack Scenario**:\n1. Attacker supplies a malicious `search_term` such as `test' OR '1'='1`.\n2. The resulting SQL becomes: `SELECT * FROM users WHERE name LIKE '%test' OR '1'='1%' OR email LIKE '%test' OR '1'='1%'`.\n3. This bypasses the search logic and returns all users.\n- **Business Impact**:\n   - Full exposure of user database\n   - Potential for further attacks using returned data\n- **Remediation**:\n```python\ndef search_users(search_term):\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    try:\n        cursor.execute(\n            \"SELECT * FROM users WHERE name LIKE ? OR email LIKE ?\",\n            (f\"%{search_term}%\", f\"%{search_term}%\")\n        )\n        results = cursor.fetchall()\n        conn.close()\n        return results\n    except Exception as e:\n        conn.close()\n        return []\n```\n\n# \ud83d\udea8 VULNERABILITY #4: SQL Injection in `update_user_status`\n- **OWASP Category**: A03:2021 - Injection\n- **CWE ID**: CWE-89\n- **Severity**: Critical\n- **Location**: Line 53-63 in utils/database.py\n- **Code Snippet**:\n```python\ndef update_user_status(user_id, status):\n    \"\"\"\u66f4\u65b0\u7528\u6237\u72b6\u6001 - \u5b58\u5728SQL\u6ce8\u5165\u6f0f\u6d1e\"\"\"\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    \n    # \u52a8\u6001\u6784\u9020UPDATE\u8bed\u53e5\n    sql = f\"UPDATE users SET status = '{status}' WHERE id = {user_id}\"\n    \n    try:\n        cursor.execute(sql)\n        conn.commit()\n        conn.close()\n        return True\n    except Exception as e:\n        conn.close()\n        return False\n```\n- **Attack Scenario**:\n1. Attacker passes a crafted `status` value like `active'; DELETE FROM users WHERE id = 1; --`.\n2. The SQL becomes: `UPDATE users SET status = 'active'; DELETE FROM users WHERE id = 1; --' WHERE id = 123`.\n3. This allows the attacker to delete arbitrary records or modify other users' data.\n- **Business Impact**:\n   - Unauthorized modification or deletion of user data\n   - Potential denial of service through data corruption\n- **Remediation**:\n```python\ndef update_user_status(user_id, status):\n    conn = sqlite3.connect('app.db')\n    cursor = conn.cursor()\n    try:\n        cursor.execute(\"UPDATE users SET status = ? WHERE id = ?\", (status, user_id))\n        conn.commit()\n        conn.close()\n        return True\n    except Exception as e:\n        conn.close()\n        return False\n``",
    "model_used": "qwen",
    "tokens_used": 2867
  }
]