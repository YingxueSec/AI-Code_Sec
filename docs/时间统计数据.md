# AI代码审计系统 - 时间统计功能

## 概述

AI代码审计系统现在支持详细的时间统计功能，可以帮助用户了解每个审计步骤的耗时情况，便于性能分析和优化。

## 功能特性

### 1. 实时时间显示
- 每个主要步骤完成后立即显示耗时
- 每个文件分析的详细时间统计
- LLM调用的具体耗时

### 2. 详细时间统计报告
- 配置加载时间
- 项目结构分析时间
- 文件过滤时间
- AI模型初始化时间
- 代码分析总时间
- 平均每文件分析时间
- 平均LLM调用时间
- LLM调用总时间和次数
- 摘要生成时间
- 结果保存时间

### 3. 时间统计数据保存
- 时间统计数据会保存到JSON结果文件中
- 便于后续分析和性能监控

## 使用方法

### 启用时间统计（默认）
```bash
# 默认启用时间统计
python main.py /path/to/project

# 显式启用详细输出
python main.py /path/to/project --verbose
```

### 禁用时间统计
```bash
# 禁用时间统计显示
python main.py /path/to/project --no-timing
```

## 输出示例

### 实时时间显示
```
⏱️  配置加载: 0.01秒
⏱️  项目结构分析: 0.00秒
⏱️  文件过滤: 0.01秒
⏱️  AI模型初始化: 0.00秒

分析 1/4: main.py
  [AI] 正在分析 python 代码...
  ⏱️  LLM分析耗时: 73.68秒
  ⏱️  文件分析总耗时: 73.68秒
```

### 时间统计报告
```
============================================================
📊 时间统计报告
============================================================
配置加载                :     0.01秒 (  0.0%)
项目结构分析              :     0.00秒 (  0.0%)
文件过滤                :     0.01秒 (  0.0%)
AI模型初始化             :     0.00秒 (  0.0%)
代码分析总时间             :   400.23秒 (100.0%)
平均每文件分析时间           :   100.06秒 ( 25.0%)
平均LLM调用时间           :   100.06秒 ( 25.0%)
LLM调用总时间            :   400.22秒 (100.0%)
LLM调用次数             :     4.00秒 (  1.0%)
摘要生成                :     0.00秒 (  0.0%)
结果保存                :     0.00秒 (  0.0%)
总执行时间               :   400.27秒 (100.0%)
============================================================
```

## JSON结果中的时间统计

时间统计数据会保存在JSON结果文件的 `timing_stats` 字段中：

```json
{
  "timing_stats": {
    "配置加载": 0.006,
    "项目结构分析": 0.003,
    "文件过滤": 0.015,
    "AI模型初始化": 0.003,
    "代码分析总时间": 400.232,
    "总分析时间": 400.232,
    "平均每文件分析时间": 100.058,
    "平均LLM调用时间": 100.056,
    "LLM调用总时间": 400.223,
    "LLM调用次数": 4,
    "摘要生成": 0.000008,
    "结果保存": 0.001,
    "总执行时间": 400.270
  }
}
```

## 性能分析建议

### 1. 识别性能瓶颈
- **LLM调用时间**：通常是最大的时间消耗
- **文件过滤时间**：大项目中可能较长
- **项目结构分析**：文件数量多时会增加

### 2. 优化建议
- 使用文件过滤减少需要分析的文件数量
- 合理设置 `max_files` 参数
- 考虑使用 `--quick` 模式进行快速扫描

### 3. 监控指标
- **平均LLM调用时间**：监控API响应性能
- **总执行时间**：整体性能指标
- **文件分析效率**：每文件平均时间

## 命令行参数

| 参数 | 描述 | 默认值 |
|------|------|--------|
| `--no-timing` | 禁用时间统计显示 | false |
| `--verbose` | 详细输出模式 | false |
| `--debug` | 调试模式 | false |

## 注意事项

1. **时间精度**：时间统计精确到毫秒级别
2. **性能影响**：时间统计功能本身对性能影响极小
3. **数据保存**：时间统计数据始终保存到JSON文件，不受 `--no-timing` 影响
4. **百分比计算**：基于总执行时间计算各步骤占比

## 故障排除

### 时间统计不显示
- 检查是否使用了 `--no-timing` 参数
- 确认使用的是最新版本的代码审计系统

### 时间数据异常
- 检查系统时间是否正确
- 确认没有其他程序影响系统性能

### LLM调用时间过长
- 检查网络连接状态
- 确认API密钥和配置正确
- 考虑调整超时设置
